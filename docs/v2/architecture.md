## 개요

V2는 “폰트 패키지”를 생성하는 빌드 시스템이 아니라, **폰트 레지스트리(데이터) + 파이프라인(재현 가능한 변환) + 퍼블리싱(배포/인덱싱)**을 하나의 제품으로 본다.

핵심 컨셉:

- **Registry-first**: 코드가 진실이 아니라 `registry`가 진실(소스 오브 트루스)이다.
- **Evidence-driven licensing**: 라이선스 판정은 “요약”이 아니라 **증거 링크/원문 스냅샷**을 기준으로 한다.
- **Deterministic artifacts**: 다운로드/변환/패키징 산출물은 파일 해시로 고정되고, 재실행 시 동일 결과가 나와야 한다.
- **Pluggable collectors**: 수집은 여러 “Collector” 플러그인으로 확장한다(특정 사이트 종속 최소화).

## 컴포넌트

### 1) Collector (발견/수집)

- 입력: 키워드/시드 URL/검색 결과/카탈로그(예: 공공기관 폰트 모음 페이지)
- 출력: `FontCandidate`(후보) 목록 + 증거 후보 링크(라이선스/다운로드/소개 페이지)
- 특징:
  - 레이트리밋/로봇 배제 준수(가능하면), 재시도/백오프
  - 중복 제거(유사 폰트/동일 파일/동일 패밀리)

### 2) Evidence Harvester (증거 수집)

- 입력: 후보의 출처 URL, 라이선스 URL, 다운로드 URL
- 출력: 원문/스냅샷(HTML/PDF/텍스트) + 타임스탬프 + 해시
- 목적: “나중에 라이선스 분쟁/변경”이 생겨도 당시의 근거를 재현 가능하게 보관

### 3) License Classifier (정책 적용)

- 입력: 증거 원문 + 메타데이터(+ 선택적으로 LLM 요약)
- 출력: `LicenseAssessment`(정책 필드) + `reviewStatus`
- 원칙:
  - LLM은 **요약/필드 추출**만 하고, 최종 배포 여부는 정책 규칙 + 검토 상태로 결정
  - 불명확하면 자동 `needs_review`로 분류

### 4) Artifact Fetcher (다운로드/고정)

- 입력: 다운로드 URL
- 출력: 원본 아티팩트(zip/otf/ttf/woff2 등), 파일 해시, 크기, MIME
- 원칙:
  - 원본은 “as-is”로 보관(가능하면)
  - 변환/서브셋은 별도 단계에서 수행

### 5) Font Validator (품질 검증)

- 입력: 폰트 파일(otf/ttf/woff/woff2)
- 출력: 품질 리포트(테이블/이름/가변폰트/유니코드 범위/손상 여부)
- 예:
  - 폰트 파서로 sfnt 테이블 검증, 이름 테이블 정합성
  - 웹 배포용 권장 포맷(woff2) 존재 여부

### 6) Packager (패키징)

- 입력: 레지스트리의 승인된 엔트리 + 고정된 아티팩트
- 출력: 패키지 디렉터리(폰트 파일 + CSS + 메타 JSON + LICENSE/EVIDENCE 링크 + 예제 이미지)
- 목표:
  - 사용자에게 “설치/임포트/사용/주의(라이선스)”가 명확한 패키지

### 7) Publisher (배포/인덱싱)

- 배포 대상:
  - npm(scope) 패키지
  - 폰트 인덱스(웹 페이지, `font_list.md` 대체/확장)
  - 레지스트리 스냅샷(버전 태그)
- 안전장치:
  - `approved` 상태만 publish
  - deprecate/삭제 정책(라이선스 변경/배포 중단 시)

## 데이터 흐름(요약)

1) Discover → 후보 생성
2) Harvest evidence → 원문/스냅샷 보관
3) Classify license → 정책 필드 채움, 검토 상태 부여
4) Fetch artifacts → 원본 다운로드, 해시 고정
5) Validate fonts → 품질 리포트/실패 사유 기록
6) Package → 산출물 생성(재현 가능)
7) Publish → 승인된 것만 배포

